
<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Orders PoC UI</title>
  <style>body{font-family:Arial;margin:20px} textarea{width:100%;height:80px} input{width:100%}</style>
</head>
<body>
  <h3>Generate API</h3>
  <label for="prompt">Prompt für API‑Generierung</label><br/>
  <textarea id="prompt">Erzeuge eine API für Bestellungen mit POST /orders (orderItems, totalAmount) und GET /orders/{id}. Status: pending, shipped, cancelled.</textarea><br/>
  <button id="gen">Generate</button>
  <pre id="genRes"></pre>

  <h3>Order Tester</h3>
  <label for="apikey">API Key</label><br/>
  <input id="apikey" style="width:400px"/><br/><br/>
  <button id="create">Create Order</button>
  <pre id="createRes"></pre>
  <br/>
  <label for="orderId">Order ID</label><br/>
  <input id="orderId" placeholder="Order ID" style="width:400px"/>
  <button id="get">Get Order</button>
  <pre id="getRes"></pre>

<script>
const base = window.location.origin; // funktioniert lokal (http://localhost:3000) und deployed

function show(elId, obj, status) {
  const el = document.getElementById(elId);
  if (!el) return;
  if (status) el.textContent = `HTTP ${status}\n` + JSON.stringify(obj, null, 2);
  else el.textContent = JSON.stringify(obj, null, 2);
}

async function safeFetch(url, options) {
  try {
    const res = await fetch(url, options);
    const text = await res.text();
    let json;
    try { json = text ? JSON.parse(text) : null; } catch(e) { json = text; }
    return { ok: res.ok, status: res.status, body: json };
  } catch (err) {
    return { ok: false, status: 0, body: { error: err.message } };
  }
}

document.getElementById('gen').onclick = async () => {
  const prompt = document.getElementById('prompt').value;
  const r = await safeFetch(base + '/generate', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({prompt})
  });
  show('genRes', r.body, r.status);
  if (r.ok && r.body && r.body.apiKey) document.getElementById('apikey').value = r.body.apiKey;
};

document.getElementById('create').onclick = async () => {
  const key = document.getElementById('apikey').value.trim();
  if (!key) { alert('Bitte API Key eintragen'); return; }
  // Einfaches orderItems-Format, das der Server erwartet (Array + totalAmount)
  const body = { orderItems:[{sku:'A1', qty:2}], totalAmount:19.98 };
  const r = await safeFetch(base + '/orders', {
    method:'POST',
    headers:{'Content-Type':'application/json','x-api-key': key},
    body: JSON.stringify(body)
  });
  show('createRes', r.body, r.status);
  if (r.ok && r.body && r.body.id) document.getElementById('orderId').value = r.body.id;
};

document.getElementById('get').onclick = async () => {
  const key = document.getElementById('apikey').value.trim();
  const id = document.getElementById('orderId').value.trim();
  if (!key || !id) { alert('API Key und Order ID erforderlich'); return; }
  const r = await safeFetch(base + '/orders/' + encodeURIComponent(id), {
    method:'GET',
    headers:{'x-api-key': key}
  });
  show('getRes', r.body, r.status);
};
</script>
</body>
</html>
